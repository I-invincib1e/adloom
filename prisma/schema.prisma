// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

// Note that some adapters may set a maximum length for the String type by default, please ensure your strings are long
// enough when changing adapters.
// See https://www.prisma.io/docs/orm/reference/prisma-schema-reference#string for more information
datasource db {
  provider = "sqlite"
  url      = "file:dev.sqlite"
}

model Session {
  id                  String    @id
  shop                String
  state               String
  isOnline            Boolean   @default(false)
  scope               String?
  expires             DateTime?
  accessToken         String
  userId              BigInt?
  firstName           String?
  lastName            String?
  email               String?
  accountOwner        Boolean   @default(false)
  locale              String?
  collaborator        Boolean?  @default(false)
  emailVerified       Boolean?  @default(false)
  refreshToken        String?
  refreshTokenExpires DateTime?
}

model Sale {
  id           String     @id @default(uuid())
  title        String
  discountType String
  value        Float
  status       String     @default("PENDING")
  startTime    DateTime
  endTime      DateTime
  processedItems Int      @default(0)
  totalItems     Int      @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  items        SaleItem[]
  overrideCents    Boolean @default(false)
  discountStrategy String  @default("COMPARE_AT") // COMPARE_AT, KEEP_COMPARE_AT, USE_CURRENT_AS_COMPARE, INCREASE_COMPARE
  excludeDrafts    Boolean @default(false)
  excludeOnSale    Boolean @default(false)
  allowOverride    Boolean @default(false)
  deactivationStrategy String @default("RESTORE") // RESTORE, REPLACE_WITH_COMPARE
  timerId          String?
  timer            Timer?     @relation(fields: [timerId], references: [id])
  tagsToAdd        String? // JSON or comma-separated
  tagsToRemove     String? // JSON or comma-separated
}

model SaleItem {
  id            String @id @default(uuid())
  saleId        String
  sale          Sale   @relation(fields: [saleId], references: [id])
  productId     String
  variantId     String
  originalPrice Float
}

model Timer {
  id           String   @id @default(uuid())
  name         String
  style        String   // JSON: colors, layout, font size, etc.
  textTemplate String
  position     String   // above_atc, below_price, below_title
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  sales        Sale[]
}

model Coupon {
  id          String          @id @default(uuid())
  offerTitle  String          // "Buy 1 Get 1"
  couponCode  String          // "BYG1"
  description String?
  style       String?         // JSON: standard, dotted, ticket, minimal
  startTime   DateTime
  endTime     DateTime
  status      String          @default("ACTIVE")
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  products    CouponProduct[]
}

model CouponProduct {
  id        String @id @default(uuid())
  couponId  String
  coupon    Coupon @relation(fields: [couponId], references: [id])
  productId String
}
